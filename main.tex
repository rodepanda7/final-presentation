\documentclass{beamer}
\usetheme{metropolis}           % Use metropolis theme
\setbeamertemplate{footline}[frame number]
\title{Formalising Modal Embeddings of Call-by-Name and Call-by-Value}
\date{\today}
\author[Floris Reuvers]{Floris Reuvers \\[1ex]
  \small Supervisor: dr. N.M. van der Weide \\
  \small Second Reader: dr. E.G.M. Hubbers
}
\institute{Radboud University} % What is actually the institute?

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{array}
\usepackage{listings}
\usepackage{rutitlepage}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xspace}
\usepackage{tabularx}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{float}
\usepackage{cmll}
\usepackage{lipsum}
\usepackage{amsthm}
\usepackage{thmtools}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{cleveref}
\usepackage{amsthm}
\usepackage{enumitem}
\usepackage{latexsym}
\usepackage{newunicodechar}
\usepackage{code/latex/agda} % path to generated agda.sty

\newcommand{\lambdabar}{\lambda\!\!\raisebox{0.6ex}{\scalebox{0.8}{--}}}

\newunicodechar{□}{\ensuremath{\mathnormal\square}}
\newunicodechar{⇒}{\ensuremath{\mathnormal\Rightarrow}}
\newunicodechar{λ}{\ensuremath{\mathnormal\lambda}}
\newunicodechar{↝}{\ensuremath{\mathnormal\leadsto}}
\newunicodechar{₁}{\ensuremath{_1}}
\newunicodechar{₂}{\ensuremath{_2}}
\newunicodechar{ₙ}{\ensuremath{_n}}
\newunicodechar{ν}{\ensuremath{\mathnormal\nu}}
\newunicodechar{ζ}{\ensuremath{\mathnormal\zeta}}
\newunicodechar{ξ}{\ensuremath{\mathnormal\xi}}
\newunicodechar{μ}{\ensuremath{\mathnormal\mu}}
\newunicodechar{β}{\ensuremath{\mathnormal\beta}}
\newunicodechar{⊢}{\ensuremath{\mathnormal\vdash}}
\newunicodechar{Γ}{\ensuremath{\mathnormal\Gamma}}
\newunicodechar{Δ}{\ensuremath{\mathnormal\Delta}}
\newunicodechar{∀}{\ensuremath{\mathnormal\forall}}
\newunicodechar{ƛ}{\ensuremath{\lambda\mkern-8mu\raisebox{0.45ex}{\rotatebox{15}{\scalebox{0.8}{--}}}}}

\newcolumntype{Y}{>{\centering\arraybackslash}X}

\RequirePackage{defs}
\RequirePackage{bussproofs}
\RequirePackage{formalgrammars}

\theoremstyle{definition}
% \newtheorem{theorem}{Theorem}[chapter] %QUESTION, SECTION OR CHAPTER?
% \newtheorem{definition}[theorem]{Definition}
% \newtheorem{lemma}[theorem]{Lemma}
% \newtheorem{proposition}[theorem]{Proposition}
% \newtheorem{example}[theorem]{Example}

% \crefname{definition}{Definition}{Definitions}
% \Crefname{definition}{Definition}{Definitions}

\begin{document}
  \maketitle
  
  \section{Introduction}

  \begin{frame}{Context}
    \begin{block}{Functional Programming Languages}
      \begin{itemize}
        \item[\textbullet] OCaml, F\#, SML, Haskell, Clean
      \end{itemize}
    \end{block}

    \begin{block}{Evaluation Strategies}
      \begin{itemize}
        \item[\textbullet] \textbf{Call-by-value (\textsf{cbv})}
          \begin{itemize}
            \item[--] Evaluate the argument first, then substitute
            \item[--] OCaml, F\#, SML
          \end{itemize}
        \item[\textbullet] \textbf{Call-by-name (\textsf{cbn})} / lazy
          \begin{itemize}
            \item[--] Substitute the argument, evaluate only when needed
            \item[--] Haskell, Clean
          \end{itemize}
      \end{itemize}
    \end{block}
  \end{frame}

  % \begin{frame}{Context}
  %   \begin{itemize}
  %     \item[\textbullet] Functional Programming Languages
  %     \item[\textbullet] Evaluation Strategies
  %     \begin{itemize}
  %       \item[--] Call-by-value (\textsf{cbv}): OCaml/F\#/SML
  %       \item[--] Call-by-name (\textsf{cbn})/Lazy Evaluation: Haskell/Clean
  %     \end{itemize}
  %     \item[\textbullet] Idea of \textsf{cbn} and \textsf{cbv}
  %     \begin{itemize}
  %       \item[--] \textsf{cbv}: first evaluate the argument, then the beta
  %       \item[--] \textsf{cbn}: evaluate the beta 
  %     \end{itemize}
  %   \end{itemize}
  % \end{frame}

  \begin{frame}{Example \textsf{cbn} and \textsf{cbv}}
    \begin{block}{Let f be defined as}
      \begin{flalign*}
        & f (x) = x * x &
      \end{flalign*}
    \end{block} \pause
    
    \begin{block}{\textsf{cbn} and \textsf{cbv} evaluation of f (3 + 3)} \pause
      \begin{align*}
        \onslide<3->{& \textsf{\textbf{\textsf{cbn}:}} &                    & \textsf{\textbf{cvb:}} &           } \\
        \onslide<4->{f (3 + 3)    & \to (3 + 3) * (3 + 3) & f (3 + 3)     & \to f (6) } \\
        \onslide<5->{             & \to 6 * (3 + 3)       &               & \to 6 * 6 } \\
        \onslide<6->{             & \to 6 * 6             &               & \to 36 }    \\
        \onslide<7->{             & \to 36}
      \end{align*}
    \end{block} \pause
  \end{frame}
  
  % \begin{frame}{Reasons to Unify \textsf{cbn} and \textsf{cbv}}
  %   \begin{itemize}
  %     \item[\textbullet] Context dependent \pause
  %     \item[\textbullet] Pro of \textsf{cbn}: \pause
  %       \begin{itemize}
  %         \item[--] more efficient when arguments are not used \pause
  %       \end{itemize}
  %     \item[\textbullet] Pro of \textsf{cbv}: \pause
  %       \begin{itemize}
  %         \item[--] more efficient when the same argument is used multiple times \pause
  %       \end{itemize}
  %     \item[\textbullet] More flexible programming languages
  %   \end{itemize}
  % \end{frame}
  \begin{frame}{Reasons to Unify \textsf{cbn} and \textsf{cbv}}
    \begin{block}{Pros/Conns of \textsf{cbn} and \textsf{cbv}}
      \begin{itemize}
        \item Sometimes arguments are used: 
        \begin{itemize}
          \item[--] \textbf{zero} times: \textbf{cbn} is more efficient
          \item[--] \textbf{multiple} times: \textbf{cbv} is more efficient
        \end{itemize}
        \pause
      \end{itemize}
    \end{block}

    \pause

    \begin{block}{Unification}
      \begin{itemize}
        \item[\textbullet] Best of both worlds
        \item[\textbullet] Universal Framework 
      \end{itemize}
    \end{block}

    % \begin{block}{Towards More Flexible Languages}
    %   Unification allows us to:
    %   \begin{itemize}
    %     \item Mix strategies as needed
    %     \item Enable optimizations
    %     \item Explore deeper theoretical connections
    %   \end{itemize}
    % \end{block}

    \end{frame}

  \begin{frame}{Approaches to Unification}

  \begin{block}{Thunks and CPS Translation}
    \begin{itemize}
      \item Wrappers around expressions to delay evaluation
      \item Continuous Passing Style translation
    \end{itemize}
    
  \end{block}

  \pause
  \begin{block}{Linear Logic}
    \begin{itemize}
      \item Explicit control over resources
      \item Arguments correspond to resources
    \end{itemize}
  \end{block}

  \pause
  \begin{block}{Modal Logic}
    \begin{itemize}
      \item Adds box modality
      \item Boxed terms are treated as values
    \end{itemize}
  \end{block}

  \end{frame}

  % \begin{frame}{Approaches to unification}
  %   \begin{itemize}
  %     \item[\textbullet] Many approaches
  %     \item[\textbullet] Thunks
  %     \item[\textbullet] Linear logic
  %     \item[\textbullet] Modal logic
  %   \end{itemize}
  % \end{frame}

  \begin{frame}{Main Contribution}
    \Large
    A formalisation of the unification of call-by-name and call-by-value using modal logic
  \end{frame}

  \section{Background}
  \begin{frame}{Grammar Lambda Calculus (\lc)}
    \begin{block}{\boldmath${\lambda}$-terms and Types}
      \vspace{7pt}
      \begin{align*}
        \begin{grammar}{
          \pr{$M, N, P, Q$}{$x \gors \lambda x.M \gors M N$}
        }
        \end{grammar}
        \quad 
        \begin{grammar}{
          \pr{$A$}{$X \gors A \fa A'$}
        }
        \end{grammar}
      \end{align*}
    \end{block} \pause
    \begin{block}{Example terms} \pause
      \begin{columns}
        \begin{column}{0.48\textwidth}
          \begin{itemize}
            \item $x$ \pause
            \item $\lamb{x}{x}$ \pause
            \item $\lamb{y}{y} z$ \pause
            \item $(\lamb{y}{y}) z$ \pause
            \item $\lamb{x}{\lamb{t}{x t (\lamb{s}{w})}wy}$
          \end{itemize}
        \end{column}
        \begin{column}{0.48\textwidth}
          \begin{itemize}
            \item $X$ \pause
            \item $X \fa X$\pause
            \item $(X \fa X) \fa X$\pause
            \item $(X \fa X) \fa (X \fa X)$
          \end{itemize}
        \end{column}
      \end{columns}
    \end{block}
  \end{frame}

  \begin{frame}{Call-by-name evaluation \lc}
    \begin{block}{\boldmath${\beta}$-reduction}
      \begin{align*}
        (\lamb{x}{M})N \red M \subst{x}{N} \quad \quad (\bn)
      \end{align*}
    \end{block}
    \begin{block}{Closure rule}
      \begin{prooftree}
        \def\extraVskip{5pt}
        \AxiomC{$M \red M'$}
        \RightLabel{($\mu$)}
        \UnaryInfC{$M N \red M' N$}
      \end{prooftree}
    \end{block}
    \begin{block}{\textsf{cbn} evaluation}
      \begin{itemize}
        \item \br together with the $\mu$ closure rule
      \end{itemize}
    \end{block}
  \end{frame}

  \begin{frame}{Call-by-box \lc}
    \begin{block}{\boldmath${\lambda}$-terms}
      \begin{align*}    
        \begin{grammar}{
          \pr{$M, N, P, Q$}{$\boxe{x} \gors \lambda x.M \gors M N \gors \boxi{N}$}
        }
        \end{grammar}
      \end{align*}
    \end{block}
    \begin{block}{Idea}
      \begin{itemize}
        \item[\textbullet] $\varepsilon$: unbox operator
        \item[\textbullet] \textsf{box}: box operator
        \item[\textbullet] paramters of abstractions are boxed
      \end{itemize}
    \end{block}
    \begin{block}{Types}
      \begin{align*}
        \begin{grammar}{
          \pr{$A$}{$X \gors B \fa A \gors B$}
        } \quad \quad
        \end{grammar}
        \begin{grammar}{
          \pr{$B$}{$\boxit{A}$}
        }
        \end{grammar}
      \end{align*}
    \end{block}
  \end{frame}

  \begin{frame}{Call-by-box evaluation}
    \begin{block}{\boldmath${\beta}$-reduction}
      \begin{align*}
        (\lamb{x}{M})\boxi{N} \red M \subst{\boxe{x}}{N} \quad \quad (\bb)
      \end{align*}
    \end{block}
    \begin{block}{Closure rules}
      \vspace{-15pt} % Adjust this value as needed (e.g. -1mm to -4mm)
      \begin{tabularx}{\textwidth}{YY}
        \begin{prooftree}
          \AxiomC{$M \rightarrow M'$} % Conclusion
          \RightLabel{$(\mu)$}
          \UnaryInfC{$M N \rightarrow M' N$}
        \end{prooftree}
        & \quad
        \begin{prooftree}
          \AxiomC{$N \rightarrow N'$} % Conclusion
          \RightLabel{$(\nu)$}
          \UnaryInfC{$M N \rightarrow M N'$}
        \end{prooftree}
      \end{tabularx}
      \vspace{10pt}
    \end{block}
    \begin{block}{cbb evaluation}
      \begin{itemize}
        \item \br together with the $\mu$ and $\nu$ closure rule
      \end{itemize}
    \end{block}
  \end{frame}

  \section{\texorpdfstring{Embeddings into \lab}{Embeddings into the boxed lambda calculus}}
  \begin{frame}{Girard's and Gödel's Translation}
    \begin{itemize}
      \item[\textbullet] Translate standard \lc into \lab
      \item[\textbullet] \textbf{Girard's} translation: \lan into \lab 
      \item[\textbullet] \textbf{Gödel's} translation: \lav into \lab
      \item[\textbullet] Call-by-box evaluation simulates
        \begin{itemize}
          \item[--] \textbf{\textsf{cbn}} under \textbf{Girard's} embedding
          \item[--] \textbf{\textsf{cbv}} under \textbf{Gödel's} embedding
        \end{itemize}
      \item[\textbullet] Notation: $\girard{M}$ is the Girard translation of $\lambda$-term $M$
      \item[\textbullet] Main propositions  
    \end{itemize}
  \end{frame}
    
  \begin{frame}{Girard's Embedding}
    \begin{block}{Translation from \textsf{cbn} $\lambda$-terms to \lab}
      \begin{align*}
        \girard{X}                 & = X                                          & \girard{x}             & = \boxe{x} \\
        \girard{(A_1 \fa A_2)}     & = \boxt{\girard{A_1}} \fa \girard{A_2}       & \girard{(\lamb{x}{M})} & = \lamb{x}{\girard{M}} \\
                                   &                                              & \girard{(M N)}         & = \girard{M} \boxi{\girard{N}}
      \end{align*}
    \end{block}
    \begin{block}{Embedding of \boldmath${(\lamb{x}{x}) y}$}
      \begin{align*}
        \girard{((\lamb{x}{x}) y)} & = \girard{(\lamb{x}{x})} \boxi{\girard{y}} \\
                                   & = (\lamb{x}{\girard{x}}) \boxi{\boxe{y}}   \\
                                   & = (\lamb{x}{\boxe{x}}) \boxi{\boxe{y}}
      \end{align*}
    \end{block}
  \end{frame}

  \begin{frame}{Girard's Image}
    \begin{block}{Well-typed terms after translation}
      \vspace{7pt}
      \begin{grammar}{
        \pr{$M, N$}{$\boxe{x} \gors \lambda x.M \gors M \boxi{N}$}
      }
      \end{grammar}
    \end{block}
    \vspace{5pt}
    \begin{itemize}
      \item[\textbullet] Eliminates the $\nu$ closure rule
      \item[\textbullet] Only the $\mu$ rule remains
      \item[\textbullet] Call-by-box becomes \textbf{deterministic}
      \item[\textbullet] If $M$ evaluates to $N$ with \textsf{cbn}, then $\girard{M}$ evaluates to $\girard{N}$ with \textsf{cbb} 
    \end{itemize}
  \end{frame}


  % \begin{frame}{Girard's Embedding}
  %   \begin{block}{Embedding}
  %     \begin{align*}
  %       \girard{X}                 & = X                                          & \girard{x}             & = \boxe{x} \\
  %       \girard{(A_1 \fa A_2)}     & = \boxt{\girard{A_1}} \fa \girard{A_2}       & \girard{(\lamb{x}{M})} & = \lamb{x}{\girard{M}} \\
  %                                  &                                              & \girard{(M N)}         & = \girard{M} \boxi{\girard{N}}
  %     \end{align*}
  %   \end{block}
  %   \begin{block}{Girard's Image}
  %     \vspace{7pt}
  %     \begin{grammar}{
	% 	    \pr{$M, N$}{$\boxe{x} \gors \lambda x.M \gors M \boxi{N}$}
	%     }
  %     \end{grammar}
  %     \begin{itemize}
  %       \item[\textbullet] $\nu$ closure rule is eliminated
  %       \item[\textbullet] only $\mu$ closure rule
  %       \item[\textbullet] cbb becomes deterministic  
  %     \end{itemize}
  %   \end{block}
  % \end{frame}

  \section{Agda}
  \begin{frame}{What is Agda?}
    \begin{itemize}
      \item Functional programming language \pause
      \item Inspired by Haskell  \pause
      \item Proof assistant \pause
      \item Dependently typed \pause
      \item Hole-based programming
    \end{itemize}
  \end{frame}

  \begin{frame}{Some Agda code}
    \begin{block}{Girard's Embedding for Types}
      \begin{align*}
        \girard{(A_1 \fa A_2)}     & = \boxt{\girard{A_1}} \fa \girard{A_2}      \\                                         
        \girard{X}                 & = X                                         
      \end{align*}
    \end{block}
    \begin{block}{Embedding in Agda}
      \input{code/latex/embedCBNIntoCBB1.tex}
    \end{block}
  \end{frame}

  \begin{frame}{Challenges}
    \begin{itemize}
      \item[\textbullet] Variables
        \begin{itemize}
          \item[--] Use of de Bruijn indices
          \item[--] Variables represented as natural numbers
        \end{itemize}
      \item[\textbullet] Ill-typed terms
        \begin{itemize}
          \item[--] \lterm $y (\lamb{x}{x})$ is not typeable
          \item[--] Solution: restrict to well-typed \lterms 
        \end{itemize}
      \item[\textbullet] Formal definition of substitution
      \item[\textbullet] Formal definition of \raiseembn in Gödel's translation %do I have time for this??? Probably not, so I'll probably skip this
    \end{itemize}
  \end{frame}

  \begin{frame}{Experience Working with Agda}
    \begin{itemize}
      \item[\textbullet] Intersting learning experience
      \item[\textbullet] High learning curve
      \item[\textbullet] Hole based programming is amazing
      \item[\textbullet] Error message are not always helpful  
      \item[\textbullet] But give it a try!
        \begin{itemize}
          \item[--] Follow the online PLFA book (Programming Language Foundations in Agda)
          \item[--] \url{https://plfa.github.io/} 
        \end{itemize}  
    \end{itemize}
  \end{frame}

  \section{Conslusions}
  
  \begin{frame}{Conclusion}
    \begin{itemize}
      \item[\textbullet] Recap of the \lc 
      \item[\textbullet] Explained \lab
      \item[\textbullet] Defined the unifying relation \textsf{cbb}  
      \item[\textbullet] Girard's translation
      \item[\textbullet] Formally proved the main properties of the translations    
    \end{itemize}
  \end{frame}

  % \section{Challenges of Formalisation}
  % \begin{frame}{Overview Challenges}
  %   \begin{itemize}
  %     \item[\textbullet] Variables
  %     \item[\textbullet] Ill typed terms
  %     \item[\textbullet] Formal definition of \raiseembn
  %   \end{itemize}
  % \end{frame}
  % \begin{frame}{De Bruijn Indices}
  %   Lorem ipsum
  % \end{frame}
  % \begin{frame}{Restriction to well-typed terms}
  %   Lorem ipsum
  % \end{frame}
  % \begin{frame}{Formal definition of \raiseembn}
  %   Lorem ipsum
  % \end{frame}

  % \section{Propositions}
  % \begin{frame}{Girard's Translation}
  %   Lorem ipsum
  % \end{frame}
  % \begin{frame}{Gödel's Translation}
  %   Lorem ipsum
  % \end{frame}

  % \section{Conclusion}
  % \begin{frame}{Conclusion}
  %   Lorem ipsum
  % \end{frame}
  % \begin{frame}{Boxed Lambda Calculus}
  %   \small
  %   \begin{block}{\textsf{cbn} \lc (\lan)}
  %     \begin{grammar}{
  %       \pr{$M, N, P, Q$}{$x \gors \lambda x.M \gors M N$}
  %     }
  %     \end{grammar}
  %     \begin{align*}
  %       (\lamb{x}{M})N \red M \subst{x}{N} \quad \quad (\bn)
  %     \end{align*}
  %   \end{block}
  %   \small
  %   \begin{block}{Boxed \lc (\lab)}
  %     \begin{grammar}{
  %       \pr{$M, N, P, Q$}{$\boxe{x} \gors \lambda x.M \gors M N \gors \boxi{N}$}
  %     }
  %     \end{grammar}
  %     \begin{align*}
  %       (\lamb{x}{M})\boxi{N} \red M \subst{\boxe{x}}{N} \quad \quad (\bb)
  %     \end{align*}
  %   \end{block}
  %   \small
  %   \begin{block}{Girard's Translation}
  %     \begin{align*}
  %       \girard{X}                 & = X                                          & \girard{x}             & = \boxe{x} \\
  %       \girard{(A_1 \fa A_2)}     & = \boxt{\girard{A_1}} \fa \girard{A_2}       & \girard{(\lamb{x}{M})} & = \lamb{x}{\girard{M}} \\
  %                                   &                                              & \girard{(M N)}         & = \girard{M} \boxi{\girard{N}}
  %     \end{align*}
  %   \end{block}
  % \end{frame}
  % \section{Research Results}
  % \begin{frame}[fragile]{Research Results}
  %   \begin{block}{Preservation of Reduction}
  %     \center  
  %     If $M \rednb N$ then $\girard{M} \redbbox \girard{N}$.
  %   \end{block}
  %   \tiny
  %   \begin{block}{Agda Proof}
  %     \input{code/latex/pres-red.tex}
  %   \end{block}
  % \end{frame}
  % \begin{frame}[fragile]{Research Results}
  %   \begin{block}{Preservation of Evaluation}
  %     If $M \redn N$ then $\girard{M} \redbn \girard{N}$.
  %   \end{block}
  %   \small
  %   \begin{block}{Agda Proof}
  %     \input{code/latex/pres-eval.tex}
  %   \end{block}
  % \end{frame}
\end{document}